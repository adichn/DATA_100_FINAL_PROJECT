---------------------------------

### Name: Aditya Chauhan

### ID: 169027493

### Class: DATA 100 A

### Professor: Dr. Devon Becker

---------------------------------

# Introduction

## Dataset: 

Air Quality (UC Irvine) (Vito, S. (2008). Air Quality [Dataset]. UCI Machine Learning Repository. <https://doi.org/10.24432/C59K5F>.)

## Abstract

Accurate air quality monitoring relies on sensor data to measure pollutants such as ozone, carbon monoxide, and nitrogen oxides. This study examines the correlation between sensor readings and measured pollutant levels to validate monitoring technologies and enhance their predictive capabilities. By leveraging models, I aim to predict carbon monoxide concentrations based on sensor data and other environmental factors.

# Goals/Research Question: 

How do sensor measurements (PT08.S1(CO) and PT08.S5(O3)) correlate with observed pollutant levels (NOx(GT) and CO(GT))?

Can these relationships improve the accuracy of carbon monoxide concentration predictions?

Descriptive Features:
- Continuous
  - PT08.S1(CO)
  - PT08.S5(O3)
  - NOx(GT)
- Categorical
  - Season
  
Target Feature:
- CO(GT)

# Basic Data Cleaning & Preprocessing

## Library Loads & Data Imports
```{r}
library(readxl)
library(tidyverse)
library(ggplot2)
library(tidymodels)
library(patchwork)
library(lubridate)
library(zoo)
library(reshape2)
library(dplyr)
library(RColorBrewer)

air_quality_data <- read_excel("AirQualityUCI.xlsx", sheet = "AirQualityUCI")
```

## Creating Categorical Features, Other Preprocessing, & Advanced Data Cleaning
```{r}
# Define pollutant columns for handling outliers
pollutant_columns <- c("CO(GT)", "NOx(GT)", "NO2(GT)")

# Data Preprocessing Pipeline
air_quality_data <- air_quality_data |>
  mutate(
    Season = case_when(
      format(Date, "%m") %in% c("12", "01", "02") ~ "Winter",
      format(Date, "%m") %in% c("03", "04", "05") ~ "Spring",
      format(Date, "%m") %in% c("06", "07", "08") ~ "Summer",
      format(Date, "%m") %in% c("09", "10", "11") ~ "Autumn"
    )
  ) |>
  group_by(Season) |>
  
  # Winsorize outliers
  mutate(
    across(all_of(pollutant_columns),
           ~ ifelse(. > quantile(., 0.95, na.rm = TRUE), quantile(., 0.95, na.rm = TRUE), .))
  ) |>
  ungroup() |>
  
  # Handle missing values using conditional replacement
  mutate(
    across(c(`NOx(GT)`, `NO2(GT)`), ~ na_if(., -200)),
    `NOx(GT)` = if_else(is.na(`NOx(GT)`), mean(`NOx(GT)`, na.rm = TRUE), `NOx(GT)`),
    `NO2(GT)` = if_else(is.na(`NO2(GT)`), mean(`NO2(GT)`, na.rm = TRUE), `NO2(GT)`)
  ) |>
  
  # Standardize Continuous Variables
  mutate(
    across(c(T, RH, AH, `PT08.S1(CO)`, `PT08.S5(O3)`), ~ scale(.))
  ) |>
  
  # Add interaction terms
  mutate(
    NOx_PT08_S1_Interaction = `NOx(GT)` * `PT08.S1(CO)`,
    NOx_Season_Interaction = as.numeric(as.factor(Season)) * `NOx(GT)`
  )

# Create lagged feature for CO(GT) (previous hour)
air_quality_data <- air_quality_data |>
  arrange(Date, Time) |>
  mutate(
    Lagged_CO = lag(`CO(GT)`, n = 1, default = NA)
  )

# Drop rows with missing values introduced by lagged features
air_quality_data <- drop_na(air_quality_data)

# Final Dataset Split
set.seed(123)
data_split <- initial_split(air_quality_data, prop = 0.7)
train_data <- training(data_split)
test_data <- testing(data_split)
```

# Exploratory & Model Plots

## Exploratory Plot/Table 1
```{r}
plot1 <- ggplot(air_quality_data, aes(x = `NOx(GT)`, y = `CO(GT)`)) +
  geom_point(alpha = 0.6, color = "steelblue", size = 1) +
  geom_smooth(method = "lm", se = TRUE, color = "darkred", linetype = "dashed", size = 1) +
  scale_y_continuous(limits = c(-10, 10), breaks = seq(-10, 10, by = 5)) +
  scale_x_continuous(limits = c(0, 600), breaks = seq(0, 600, by = 100)) +
  labs(
    title = "Relationship Between NOx(GT) and CO(GT)",
    x = "NOx(GT) (Nitrogen Oxides)",
    y = "CO(GT) (Carbon Monoxide)"
  ) +
  theme_minimal(base_size = 12) +
  theme(plot.title = element_text(face = "bold"))

# This plot showcases the relationship betwen NOx(GT) and CO(GT), critical to the research question because it visually establishes whether there is a relationship between these variables

```

## Exploratory Plot/Table 2
```{r}
plot2 <- ggplot(air_quality_data, aes(x = `NOx(GT)` * `PT08.S1(CO)`, y = `CO(GT)`, color = Season)) +
  geom_point(alpha = 0.6, size = 1.5) +
  geom_smooth(method = "lm", se = TRUE, color = "orange", linetype = "dotted", size = 1) +
  scale_y_continuous(limits = c(-10, 10), breaks = seq(-10, 10, by = 5)) +
  scale_x_continuous(limits = c(-2000, 1000), breaks = seq(-2000, 1000, by = 500)) +
  scale_color_brewer(palette = "Set2") +
  labs(
    title = "Interaction Between NOx(GT) and Sensor Data on CO(GT)",
    x = "NOx(GT) * PT08.S1(CO) (Interaction Term)",
    y = "CO(GT) (Carbon Monoxide)",
    color = "Season"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold"),
    legend.position = "bottom"
  )

# This plot examine show the interaction of NOx(GT) and PT08.S1(CO) relates to CO(GT). By categorizing the data by season, it integrates continuous & categorical features and helps with understanding how sensor data correlates with pollutants in different contexts of environment
```

```{r}
# Combine the two plots
final_exploratory_plot <- plot1 | plot2 +
  plot_layout(guides = "collect") & 
  theme(legend.position = "bottom")

# Render the combined exploratory plot
final_exploratory_plot

# In plot 1, the positive correlation between NOx(GT) and CO(GT) indicates that higher NOx levels are associated with higher CO levels, consistent with established emission patterns in urban areas. This aligns with the role of shared sources like vehicle emissions and industrial activities.

# In plot 2, the interaction term highlights the complex relationship between NOx(GT) and PT08.S1(CO), revealing how sensor efficiency varies by season. In winter, the interaction term is often negative, likely due to reduced sensor performance caused by cold temperatures and atmospheric conditions. In contrast, spring and autumn show predominantly positive interaction values, reflecting improved sensor performance, while summer demonstrates the highest efficiency due to favorable environmental factors for pollutant detection.
```

## Model Plot 1
```{r}


```

## Model Plot 2
```{r}


```

# Linear Models

## Exploratory Linear Model 1
```{r}


```

## Exploratory linear model 2
```{r}


```

## Final Linear Model, Diagnostics & Interpretations
```{r}


```

# Conclusions & Limitations

